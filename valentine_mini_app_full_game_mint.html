<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Valentine Week on Base ðŸ’–</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&family=Pacifico&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.min.js"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body{font-family:'Poppins',sans-serif;min-height:100vh;background: radial-gradient(circle at top left,#ff5f9e,#ffc371,#ff9a9e);display:flex;justify-content:center;align-items:center;overflow:hidden;}
    .container{background: rgba(255,255,255,0.15);backdrop-filter: blur(16px);border-radius: 32px;padding: 36px;max-width: 440px;width: 95%;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,0.3);position:relative;}
    h1{font-family:'Pacifico',cursive;font-size:2.4rem;color:#fff;margin-bottom:16px;}
    p{font-size:1rem;color:#fff;opacity:0.9;margin-bottom:24px;}
    input,textarea,button{width:90%;margin:12px 0;padding:12px 16px;border-radius:16px;border:none;font-size:1rem;}
    input,textarea{outline:none;resize:none;font-family:'Poppins',sans-serif;}
    textarea{height:80px;}
    button{background:#ff2f7b;color:#fff;font-weight:600;cursor:pointer;box-shadow:0 10px 30px rgba(0,0,0,0.25);transition:0.3s;}
    button:hover{transform:translateY(-2px);background:#ff4f91;}
    .heart{position:absolute;color:rgba(255,255,255,0.5);font-size:20px;animation:rise 6s linear infinite;}
    @keyframes rise{0%{transform:translateY(100vh) scale(0.5);opacity:0;}50%{opacity:1;}100%{transform:translateY(-10vh) scale(1.2);opacity:0;}}
    .love-hash,.history,.game{margin-top:16px;color:#fff;font-weight:700;}
    .history{max-height:200px;overflow-y:auto;background: rgba(255,255,255,0.1);padding:12px;border-radius:16px;}
    .game-canvas{width:100%;height:200px;background: rgba(255,255,255,0.05);border-radius:16px;position:relative;overflow:hidden;margin-top:12px;}
    .score{margin-top:8px;font-weight:700;color:#fff;}
    .mint-btn{margin-top:8px;background:#ffd700;color:#000;}
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ’– Your Love On-Chain ðŸ’–</h1>
    <p>Send a love message, generate Love Hash, tip, or play the heart game!</p>

    <input type="text" id="yourName" placeholder="Your Name" />
    <input type="text" id="crushName" placeholder="Your Crush Name" />
    <textarea id="message" placeholder="Type your love message..."></textarea>
    <button onclick="sendLove()">Send Love ðŸ’Œ (0.1$)</button>
    <input type="number" id="tipAmount" placeholder="Tip Amount in $ (e.g. 0.05)" step="0.01" min="0.01" />
    <button onclick="tipLove()">Send Tip ðŸ’–</button>

    <div class="love-hash" id="loveHash">Your Love Hash will appear here ðŸ’˜</div>

    <button onclick="toggleHistory()">Show/Hide My Love Log ðŸ“œ</button>
    <div class="history" id="history" style="display:none;"></div>

    <div class="game">
      <p>ðŸŽ¯ Catch the Hearts Game! Click hearts to score.</p>
      <div class="game-canvas" id="gameCanvas"></div>
      <div class="score" id="scoreDisplay">Score: 0</div>
      <button class="mint-btn" id="mintBtn" onclick="mintScore()" style="display:none;">Mint High Score ðŸ’Ž</button>
    </div>
  </div>

  <script>
    // Floating background hearts
    setInterval(()=>{
      const heart=document.createElement('div');
      heart.className='heart';
      heart.innerText='â¤';
      heart.style.left=Math.random()*100+'vw';
      heart.style.animationDuration=4+Math.random()*4+'s';
      document.body.appendChild(heart);
      setTimeout(()=>heart.remove(),8000);
    },400);

    // History management
    let history = JSON.parse(localStorage.getItem('loveHistory')||'[]');
    function updateHistoryDisplay(){
      const h = document.getElementById('history');
      h.innerHTML='';
      history.forEach(e=>{const div=document.createElement('div');div.textContent=e;h.appendChild(div);});
    }
    function toggleHistory(){
      const h = document.getElementById('history');
      if(h.style.display==='none'){h.style.display='block';updateHistoryDisplay();}
      else h.style.display='none';
    }

    function addToHistory(entry){
      history.push(entry);
      localStorage.setItem('loveHistory',JSON.stringify(history));
    }

    // Love Hash generator
    function generateLoveHash(){
      const yourName=document.getElementById('yourName').value.trim();
      const crushName=document.getElementById('crushName').value.trim();
      if(!yourName||!crushName){alert('Enter both names to generate Love Hash!');return;}
      const combined=yourName+crushName;
      let hash=0;for(let i=0;i<combined.length;i++){hash+=combined.charCodeAt(i);}
      const lovePercent=(hash%101);
      const result=`${yourName} â¤ï¸ ${crushName} = ${lovePercent}%`;
      document.getElementById('loveHash').innerText=result;
      addToHistory(result+' (Love Hash)');
    }

    async function sendLove(){
      generateLoveHash();
      if(typeof window.ethereum!=='undefined'){
        try{
          await ethereum.request({method:'eth_requestAccounts'});
          const provider=new ethers.providers.Web3Provider(window.ethereum);
          const signer=provider.getSigner();
          const tx=await signer.sendTransaction({
            to:'0x5E8441c68A23134aE89838fDEFf4a8F422436e88',
            value:ethers.utils.parseEther('0.00005')
          });
          addToHistory('Love message sent on-chain');
          alert('Love message sent on-chain! ðŸ’–');
        }catch(err){console.error(err);alert('Transaction failed or cancelled.');}
      }else{alert('Please install a Base wallet!');}
    }

    async function tipLove(){
      let tipValue=parseFloat(document.getElementById('tipAmount').value);
      if(isNaN(tipValue)||tipValue<=0) tipValue=0.05;
      const usdToEthRate=0.00005;
      const ethValue=tipValue*usdToEthRate;
      if(typeof window.ethereum!=='undefined'){
        try{
          await ethereum.request({method:'eth_requestAccounts'});
          const provider=new ethers.providers.Web3Provider(window.ethereum);
          const signer=provider.getSigner();
          const tx=await signer.sendTransaction({
            to:'0x5E8441c68A23134aE89838fDEFf4a8F422436e88',
            value:ethers.utils.parseEther(ethValue.toString())
          });
          addToHistory(`Tip sent $${tipValue}`);
          alert(`Thanks for sending $${tipValue} love! ðŸ’–`);
        }catch(err){console.error(err);alert('Transaction failed or cancelled.');}
      }else{alert('Please install a Base wallet!');}
    }

    // Mini-game: Catch Hearts
    const canvas=document.getElementById('gameCanvas');
    let score=0;let hearts=[];const maxHearts=5;
    function spawnHeart(){
      const h=document.createElement('div');
      h.className='heart';h.style.position='absolute';
      h.style.fontSize='24px';h.style.left=Math.random()*90+'%';h.style.top='0px';
      h.style.cursor='pointer';
      h.onclick=()=>{score++;document.getElementById('scoreDisplay').innerText='Score: '+score;h.remove();checkHighScore();};
      canvas.appendChild(h);
      hearts.push(h);
      let fall=setInterval(()=>{
        const top=parseFloat(h.style.top);
        if(top>180){h.remove();clearInterval(fall);}else h.style.top=(top+2)+'px';
      },20);
    }
    setInterval(()=>{if(hearts.length<maxHearts) spawnHeart();},1000);

    // Mint High Score
    function checkHighScore(){
      let best=parseInt(localStorage.getItem('bestScore')||'0');
      if(score>best){
        document.getElementById('mintBtn').style.display='inline-block';
      }
    }
    async function mintScore(){
      const tipValue=0.05;const usdToEthRate=0.00005;
      const ethValue=tipValue*usdToEthRate;
      if(typeof window.ethereum!=='undefined'){
        try{
          await ethereum.request({method:'eth_requestAccounts'});
          const provider=new ethers.providers.Web3Provider(window.ethereum);
          const signer=provider.getSigner();
          const tx=await signer.sendTransaction({
            to:'0x5E8441c68A23134aE89838fDEFf4a8F422436e88',
            value:ethers.utils.parseEther(ethValue.toString())
          });
          localStorage.setItem('bestScore',score);
          addToHistory(`Minted High Score ${score} ðŸ’Ž`);
          alert(`High score ${score} minted on-chain! ðŸ’Ž`);
          document.getElementById('mintBtn').style.display='none';
        }catch(err){console.error(err);alert('Transaction failed or cancelled.');}
      }else{alert('Please install a Base wallet!');}
    }

  </script>
</body>
</html>
